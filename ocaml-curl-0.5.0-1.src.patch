--- origsrc/ocurl/Makefile.in	2004-07-19 12:06:31.000000000 -0500
+++ src/ocurl/Makefile.in	2008-07-17 19:37:12.812500000 -0500
@@ -28,7 +28,7 @@
 CURLBCOBJS	= $(CURLOBJS:.cmx=.cmo)
 
 CURLFLAGS	= -ccopt @CURLFLAGS@
-CURLCLIBS	= -cclib -lcurl-helper -cclib "@CURLLIBS@"
+CURLCLIBS	= -cclib -lcurl-helper -cclib "@CURLFLAGS@ @CURLLIBS@"
 
 ifeq (@OCAMLBEST@,opt)
 TARGETS		= curl.cma curl.cmxa libcurl-helper.a
@@ -46,7 +46,7 @@
 		(cd examples; $(MAKE))
 
 curl.cma:	$(CURLBCOBJS) libcurl-helper.a
-		$(OCBYTE) -custom -a $(FLAGS) $(CURLFLAGS) -o $@ $(CURLBCOBJS) $(CURLCLIBS)
+		$(OCBYTE) -custom -a $(FLAGS) -dllib dllcurl-helper $(CURLFLAGS) -o $@ $(CURLBCOBJS) $(CURLCLIBS)
 
 curl.cmxa:	$(CURLOBJS) libcurl-helper.a
 		$(OCOPT) -a $(FLAGS) $(CURLFLAGS) $(LIBS) $(CURLOBJS) -o $@ $(CURLCLIBS)
@@ -61,16 +61,15 @@
 		$(OCBYTE) -c $(FLAGS) $< -o $@
 
 libcurl-helper.a:	$(CURLHELPEROBJS)
-		ar crus libcurl-helper.a $(CURLHELPEROBJS)
-		ranlib libcurl-helper.a
+		ocamlmklib -o curl-helper $(CURLHELPEROBJS) @CURLFLAGS@
 
 .c.o:
 		$(CC) -c $(CFLAGS) $(CAMLINCDIR) $< -o $@
 
 install:
 ifeq ($(FINDLIB),ocamlfind)
-		ocamlfind install curl META $(wildcard *.cmi) \
-			 $(wildcard *.a) $(wildcard *.cma) $(wildcard *.cmxa)
+		ocamlfind install curl META dllcurl-helper.so $(TARGETS) \
+			curl.a curl.cmi curl.mli
 else
 		mkdir -p $(INSTALLDIR)
 		$(INSTALLDATA) curl.cma $(INSTALLDIR)
